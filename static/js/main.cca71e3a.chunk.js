(this["webpackJsonpplay-back"]=this["webpackJsonpplay-back"]||[]).push([[0],{14:function(e,t,n){},19:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),o=n(8),a=n.n(o),s=(n(14),n(3)),c=n(4),l=n.n(c),u="freeze",d="restart",f="select",v="reverse",h="forward",y="move",p="moveEnd",b="rotate",g="rotateEnd",m=["space","r","ctrl","w","a","s","d","up","left","down","right","q","e","shift"],E=["w","a","s","d","up","left","down","right","q","e","shift"];var x=function(e){var t=e.onGameEvent,n=function(e,n){return t({type:e,data:n})};return r.a.createElement(r.a.Fragment,null,r.a.createElement(l.a,{handleKeys:m,onKeyEvent:function(e){switch(e){case"space":return n(u);case"r":return n(d);case"ctrl":return n(f);case"w":case"up":return n(y,"up");case"s":case"down":return n(y,"down");case"a":case"left":return n(y,"left");case"d":case"right":return n(y,"right");case"q":return n(b,"ccw");case"e":return n(b,"cw");case"shift":return n(v);default:return}}}),r.a.createElement(l.a,{handleEventType:"keyup",handleKeys:E,onKeyEvent:function(e){switch(e){case"w":case"up":return n(p,"up");case"s":case"down":return n(p,"down");case"a":case"left":return n(p,"left");case"d":case"right":return n(p,"right");case"q":return n(g,"ccw");case"e":return n(g,"cw");case"shift":return n(h);default:return}}}))};var w=function(e){var t=e.data,n=e.onEnterGoal,i=r.a.useRef();return r.a.useEffect((function(){i.current&&t&&!t.initialized&&(t.init(i.current,(function(){n()})),t.start())}),[i,t,n]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{id:"stageInner",ref:i}),r.a.createElement(x,{onGameEvent:t.handleGameKeyEvent}))},S=n(1),M=function(e){return function(t){return e(t)}},O=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return M((function(i){return{body:S.Bodies.circle(i(e),i(t),i(n),{restitution:1,render:{fillStyle:"#D7DCE3"},friction:0,frictionAir:.025,density:1e-5}),meta:{gravity:!0,reversable:!0}}}))},B=function(e,t,n){return M((function(i){return{body:S.Bodies.rectangle(i(e),i(t),i(n),i(n),{isStatic:!0,isSensor:!0,render:{fillStyle:"#94FBAB"}}),meta:{}}}))},z=function(e){var t=e.live,n=e.color,i=e.selectColor,r=e.selectable,o=e.pushes,a=e.fixedRotation,s=e.fixedPosition;return function(e,c,l,u){var d=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,f=arguments.length>5?arguments[5]:void 0;return M((function(v){return{body:S.Bodies.rectangle(v(e),v(c),v(l),v(u),{isStatic:!0,angle:d,render:{fillStyle:n},friction:0,frictionAir:0}),meta:{live:t,color:n,selectColor:i,selectable:r,pushes:o,fixedRotation:a,bounded:f,fixedPosition:s}}}))}},T=z({color:"#6D7F8D",selectColor:"#D7DCE3",selectable:!0}),j=z({color:"#6D7F8D",selectColor:"#D7DCE3",selectable:!0,fixedPosition:!0}),P=z({color:"#7E262E",selectColor:"#AD343E",selectable:!0,fixedRotation:!0,pushes:!0}),R=z({color:"#1D3742"}),V=function(e,t,n,i,r){return M((function(o){return{body:S.Bodies.rectangle(o(e),o(t),o(n),o(i),{isSensor:!0,render:{fillStyle:r,opacity:.5}}),meta:{color:r}}}))},k=n(2),A=n(6),D=function e(t,n){var i=this;Object(k.a)(this,e),this.startMove=function(e){i[e]=!0},this.stopMove=function(e){i[e]=!1},this.getVelocity=function(){return{x:((i.left?-1:0)+(i.right?1:0))*i.speed/1e3,y:((i.up?-1:0)+(i.down?1:0))*i.speed/1e3}},this.getAngularVelocity=function(){return((i.ccw?-1:0)+(i.cw?1:0))*i.angularSpeed/1e3},this.isMoving=function(){var e=i.getVelocity(),t=e.x,n=e.y;return t||n||i.getAngularVelocity()},this.speed=t,this.angularSpeed=n;for(var r=0,o=["up","down","left","right","cw","ccw"];r<o.length;r++){this[o[r]]=!1}},C=function e(t){var n=this;Object(k.a)(this,e),this.log=function(e){var t=n.history.length?n.history[n.history.length-1].position:n.body.position,i=S.Vector.sub(n.body.position,t),r=n.body.position,o=r.x,a=r.y;n.history.push({time:e,position:{x:o,y:a},delta:i})},this.clear=function(){n.history=[]},this.revertTo=function(e){for(var t=S.Vector.create(),i=n.history.length-1;i>=0;i--){var r=n.history[i],o=r.time,a=r.delta;if(t=S.Vector.sub(t,a),!(o>e)){S.Body.translate(n.body,t),n.history.splice(i,n.history.length);break}}},this.body=t,this.history=[]},I=["gravity","selectable","reversable","fixedRotation","bounded","fixedPosition"],F=function e(t,n){var i=this;Object(k.a)(this,e),this.start=function(){i.frozenVelocities={},i.activeObjectIndex=0,i.selectMovement=new D(i.normalize(500),20)},this.attachEventListeners=function(){i.registerCollisionListener("spirit","goal",i.level.onEnterGoal)},this.registerCollisionListener=function(e,t,n){var r=i.bodyMap[e].id,o=i.bodyMap[t].id;S.Events.on(i.level.loop.engine,"collisionStart",(function(e){var t,i=Object(A.a)(e.pairs);try{for(i.s();!(t=i.n()).done;){var a=t.value,s=a.bodyA,c=a.bodyB;if(s.id===r&&c.id===o||s.id===o&&c.id===r)return n()}}catch(l){i.e(l)}finally{i.f()}}))},this.normalize=function(e){return e/100*700},this.update=function(){i.updatePushes(),i.updateGravityBodies(),i.updateSelectables(),i.updateHistories(),i.updateReversables(),i.updateFixedRotations(),i.updateBoundeds(),i.updateFixedPositions(),i.checkSpiritOutOfBounds()},this.updatePushes=function(){var e=i.level.objectSelectOrder[i.activeObjectIndex],t=!i.metaMap[e].pushes&&i.level.frozen;i.byTrait.gravity.forEach((function(e){i.bodyMap[e].isStatic!==t&&S.Body.setStatic(i.bodyMap[e],t)}))},this.updateGravityBodies=function(){var e={x:0,y:0},t=i.level.frozen?function(t){S.Body.setVelocity(t,e)}:function(e){var t={x:0*e.mass,y:.002*e.mass};S.Body.applyForce(e,e.position,t)};i.byTrait.gravity.forEach((function(e){t(i.bodyMap[e])}))},this.updateSelectables=function(){var e=i.level.objectSelectOrder[i.activeObjectIndex];i.byTrait.selectable.forEach((function(t){var n=i.bodyMap[t],r=i.metaMap[t],o=r.color,a=r.selectColor,s=r.live,c=r.fixedRotation,l=r.fixedPosition,u=i.selectMovement;u.isMoving()||n.isStatic||S.Body.setStatic(n,!0);var d=t===e,f=!!s!==i.level.frozen,v=o;d&&f&&(v=a,u.isMoving()&&(S.Body.setStatic(n,!1),l||S.Body.setVelocity(n,u.getVelocity()),c||S.Body.setAngularVelocity(n,u.getAngularVelocity()))),n.render.fillStyle=v}))},this.updateHistories=function(){i.level.frozen||i.byTrait.reversable.forEach((function(e){i.histories[e].log(i.level.getPlayTime())}))},this.updateReversables=function(){if(i.level.reversed){var e=i.level.getPlayTime();for(var t in i.histories)i.histories[t].revertTo(e)}},this.updateFixedRotations=function(){i.byTrait.fixedRotation.forEach((function(e){S.Body.setAngle(i.bodyMap[e],0)}))},this.updateFixedPositions=function(){i.byTrait.fixedPosition.forEach((function(e){var t=i.fixedPositions[e],n=t.x,r=t.y;S.Body.setPosition(i.bodyMap[e],{x:n,y:r})}))},this.checkSpiritOutOfBounds=function(){var e=i.bodyMap.spirit.position,t=e.x,n=e.y,r=-i.normalize(20),o=700+i.normalize(20);(t<=r||n<=r||t>=o||n>=o)&&i.level.onSpiritOutOfBounds()},this.updateBoundeds=function(){var e=i.normalize(1);i.byTrait.bounded.forEach((function(t){var n=i.bodyMap[t],r=i.metaMap[t].bounded,o=i.bodyMap[r],a=Object(s.a)(n.vertices,4),c=a[0],l=a[1],u=a[2],d=a[3],f=Object(s.a)(o.vertices,3),v=f[0],h=f[2],y=0,p=0,b=Math.min(c.y,l.y),g=Math.min(c.x,d.x),m=Math.max(u.y,d.y),E=Math.max(u.x,l.x),x=v.y+e,w=v.x+e,M=h.y-e,O=h.x-e;b<x&&(p+=x-b),m>M&&(p-=m-M),g<w&&(y+=w-g),E>O&&(y-=E-O),(y||p)&&S.Body.translate(n,{x:y,y:p})}))},this.freeze=function(){var e={};i.byTrait.gravity.forEach((function(t){var n=i.bodyMap[t].velocity,r=n.x,o=n.y;e[t]={x:r,y:o}})),i.frozenVelocities=e},this.unfreeze=function(){i.byTrait.gravity.forEach((function(e){var t=i.frozenVelocities[e];if(t){var n=t.x,r=t.y;S.Body.setVelocity(i.bodyMap[e],{x:n,y:r})}}))},this.selectNext=function(){var e=i.activeObjectIndex+1;e>=i.level.objectSelectOrder.length&&(e=0),i.activeObjectIndex=e},this.moveSelected=function(e){i.selectMovement.startMove(e)},this.stopMovingSelected=function(e){i.selectMovement.stopMove(e)},this.level=t;var r=[],o={},a={},c={},l={},u={};for(var d in I.forEach((function(e){return u[e]=[]})),n){var f=n[d](this.normalize),v=f.body,h=f.meta;r.push(v),o[d]=v,a[d]=h;var y,p=Object(A.a)(I);try{for(p.s();!(y=p.n()).done;){var b=y.value;void 0!==h[b]&&u[b].push(d)}}catch(x){p.e(x)}finally{p.f()}if(h.reversable&&(c[d]=new C(v)),h.fixedPosition){var g=v.position,m=g.x,E=g.y;l[d]={x:m,y:E}}}this.all=r,this.bodyMap=o,this.metaMap=a,this.byTrait=u,this.histories=c,this.fixedPositions=l},G=function e(t,n){var i=this;Object(k.a)(this,e),this.start=function(e,t,n){i.render=S.Render.create({element:e,engine:i.engine,options:{wireframes:!1,width:700,height:700,background:"#03171B"}}),S.Render.world(i.render),i.intervalRef=setInterval(i.update,10),i.playTime=0},this.update=function(){i.globalTime+=10,i.level.reversed?i.playTime=Math.max(0,i.playTime-10):i.level.frozen||(i.playTime+=10),i.level.blockingEvent||(i.level.update(),S.Engine.update(i.engine,10),S.Render.world(i.render))},this.teardown=function(){i.intervalRef=clearInterval(i.intervalRef),S.Render.stop(i.render),S.World.clear(i.engine.world),S.Engine.clear(i.engine),i.render.canvas.remove(),setTimeout((function(){i.render.canvas=null,i.render.context=null,i.render.textures={}}),10)},this.level=t,this.globalTime=0,this.engine=S.Engine.create(),this.engine.world.gravity.scale=0,S.World.add(this.engine.world,n)},K=function e(t,n){var i=this;Object(k.a)(this,e),this.init=function(e,t,n){i.ref=e,i.onEnterGoal=t,i.initialized=!0},this.start=function(){i.bodies=new F(i,i.bodiesInitializer),i.loop=new G(i,i.bodies.all),i.bodies.start(),i.loop.start(i.ref),i.bodies.attachEventListeners(),i.started=!0,i.frozen=!0,i.events=[],i.blockingEvent=!1},this.update=function(){if(i.events.length){i.blockingEvent=!0;var e=i.events.shift();i.executeEvent(e),i.blockingEvent=!1}i.bodies.update()},this.handleGameKeyEvent=function(e){i.events.push(e)},this.executeEvent=function(e){var t=e.type,n=e.data;switch(t){case u:return i.frozen?i.unfreeze():i.freeze();case d:return i.restart();case f:return i.bodies.selectNext();case y:case b:return i.bodies.moveSelected(n);case p:case g:return i.bodies.stopMovingSelected(n);case v:return i.reverse();case h:return i.forward();default:console.log("not handled",t)}},this.teardown=function(){i.loop.teardown()},this.restart=function(){i.teardown(),i.start()},this.getPlayTime=function(){return i.loop.playTime},this.freeze=function(){i.frozen=!0,i.bodies.freeze()},this.unfreeze=function(){i.frozen=!1,i.bodies.unfreeze()},this.reverse=function(){i.freeze(),i.reversed=!0},this.forward=function(){i.reversed=!1},this.onSpiritOutOfBounds=function(){i.restart()},this.bodiesInitializer=t,this.objectSelectOrder=n,this.initialized=!1},L=[{name:"Lander",level:function(){return new K({spirit:O(10,10,2),ground:T(42,80,80,2),goal:B(90,90,4)},["ground"])}},{name:"Landerer",level:function(){return new K({spirit:O(10,10,2),ground:T(42,80,30,2),goal:B(90,90,4)},["ground"])}},{name:"Push",level:function(){return new K({goal:B(90,90,4),spirit:O(20,10,2),pusherBound:V(45,60,80,10,"#7E262E"),pusher:P(10,60,8,8,0,"pusherBound"),ground:R(20,30,30,2,.5)},["pusher"])}},{name:"Tower",level:function(){return new K({goal:B(50,20,4),spirit:O(20,10,2),pusherBound:V(50,90,90,10,"#7E262E"),pusher:P(90,90,8,8,0,"pusherBound"),wall1:R(50,10,24,2),wall2:R(39,45,2,70),wall3:R(61,45,2,70)},["pusher"])}},{name:"Plateau",level:function(){return new K({goal:B(20,80,4),spirit:O(10,5,2),topWall:j(40,30,70,2),goalShield:R(20,65,50,2,-.5),pusherBound:V(80,80,38,38,"#7E262E"),pusher:P(90,90,8,8,0,"pusherBound")},["topWall","pusher"])}}];var N=function(e){var t=e.onSetLevel;return r.a.createElement(l.a,{handleKeys:["numeric"],onKeyEvent:function(e){return t(Number(e))}})};n(19);var W=function(){var e=r.a.useState(),t=Object(s.a)(e,2),n=t[0],i=t[1],o=r.a.useState(),a=Object(s.a)(o,2),c=a[0],l=a[1],u=r.a.useState(0),d=Object(s.a)(u,2)[1],f=function(){var e=r.a.useState(!1),t=Object(s.a)(e,2),n=t[0],i=t[1],o=r.a.useState(null),a=Object(s.a)(o,2),c=a[0],l=a[1],u=r.a.useState(3e3),d=Object(s.a)(u,2),f=d[0],v=d[1];return r.a.useEffect((function(){!c||f<0||setTimeout((function(){return l(null)}),f)}),[c,f]),{setAnimate:i,monitorClass:"Monitor"+(n?" TurnOn":""),overlayText:c,setOverlayText:l,setOverlayTextDuration:v}}(),v=f.setAnimate,h=f.monitorClass,y=f.overlayText,p=f.setOverlayText,b=function(e){c&&c.teardown(),i(e),l(L[e].level()),v(!0),p(function(e){return"".concat(e+1,": ").concat(L[e].name)}(e))};return r.a.createElement("div",{className:"App"},r.a.createElement("div",{className:h,onAnimationEnd:function(){return v(!1)}},r.a.createElement("div",{className:"Screen"},c&&r.a.createElement(w,{data:c,onUpdateData:function(){d((function(e){return e+1}))},onEnterGoal:function(){b(n+1)}})),r.a.createElement("div",{className:"Overlay"},y)),r.a.createElement(N,{onSetLevel:b}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(W,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},9:function(e,t,n){e.exports=n(20)}},[[9,1,2]]]);
//# sourceMappingURL=main.cca71e3a.chunk.js.map